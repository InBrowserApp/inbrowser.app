<i18n lang="json">
{
  "en": {
    "arabicNumber": "Arabic Number (1-3999)",
    "romanNumeral": "Roman Numeral",
    "enterArabicNumber": "Enter Arabic number...",
    "enterRomanNumeral": "Enter Roman numeral..."
  },
  "zh": {
    "arabicNumber": "阿拉伯数字 (1-3999)",
    "romanNumeral": "罗马数字",
    "enterArabicNumber": "请输入阿拉伯数字...",
    "enterRomanNumeral": "请输入罗马数字..."
  },
  "zh-CN": {
    "arabicNumber": "阿拉伯数字 (1-3999)",
    "romanNumeral": "罗马数字",
    "enterArabicNumber": "请输入阿拉伯数字...",
    "enterRomanNumeral": "请输入罗马数字..."
  },
  "zh-TW": {
    "arabicNumber": "阿拉伯數字 (1-3999)",
    "romanNumeral": "羅馬數字",
    "enterArabicNumber": "請輸入阿拉伯數字...",
    "enterRomanNumeral": "請輸入羅馬數字..."
  },
  "zh-HK": {
    "arabicNumber": "阿拉伯數字 (1-3999)",
    "romanNumeral": "羅馬數字",
    "enterArabicNumber": "請輸入阿拉伯數字...",
    "enterRomanNumeral": "請輸入羅馬數字..."
  },
  "es": {
    "arabicNumber": "Número Arábigo (1-3999)",
    "romanNumeral": "Número Romano",
    "enterArabicNumber": "Ingrese número arábigo...",
    "enterRomanNumeral": "Ingrese número romano..."
  },
  "fr": {
    "arabicNumber": "Nombre Arabe (1-3999)",
    "romanNumeral": "Chiffre Romain",
    "enterArabicNumber": "Entrez un nombre arabe...",
    "enterRomanNumeral": "Entrez un chiffre romain..."
  },
  "de": {
    "arabicNumber": "Arabische Zahl (1-3999)",
    "romanNumeral": "Römische Zahl",
    "enterArabicNumber": "Arabische Zahl eingeben...",
    "enterRomanNumeral": "Römische Zahl eingeben..."
  },
  "it": {
    "arabicNumber": "Numero Arabo (1-3999)",
    "romanNumeral": "Numero Romano",
    "enterArabicNumber": "Inserisci numero arabo...",
    "enterRomanNumeral": "Inserisci numero romano..."
  },
  "ja": {
    "arabicNumber": "アラビア数字 (1-3999)",
    "romanNumeral": "ローマ数字",
    "enterArabicNumber": "アラビア数字を入力...",
    "enterRomanNumeral": "ローマ数字を入力..."
  },
  "ko": {
    "arabicNumber": "아라비아 숫자 (1-3999)",
    "romanNumeral": "로마 숫자",
    "enterArabicNumber": "아라비아 숫자 입력...",
    "enterRomanNumeral": "로마 숫자 입력..."
  },
  "ru": {
    "arabicNumber": "Арабское число (1-3999)",
    "romanNumeral": "Римская цифра",
    "enterArabicNumber": "Введите арабское число...",
    "enterRomanNumeral": "Введите римскую цифру..."
  },
  "pt": {
    "arabicNumber": "Número Arábico (1-3999)",
    "romanNumeral": "Numeral Romano",
    "enterArabicNumber": "Digite número arábico...",
    "enterRomanNumeral": "Digite numeral romano..."
  },
  "ar": {
    "arabicNumber": "الرقم العربي (1-3999)",
    "romanNumeral": "الرقم الروماني",
    "enterArabicNumber": "أدخل الرقم العربي...",
    "enterRomanNumeral": "أدخل الرقم الروماني..."
  },
  "hi": {
    "arabicNumber": "अरबी संख्या (1-3999)",
    "romanNumeral": "रोमन अंक",
    "enterArabicNumber": "अरबी संख्या दर्ज करें...",
    "enterRomanNumeral": "रोमन अंक दर्ज करें..."
  },
  "tr": {
    "arabicNumber": "Arap Sayısı (1-3999)",
    "romanNumeral": "Roma Rakamı",
    "enterArabicNumber": "Arap sayısı girin...",
    "enterRomanNumeral": "Roma rakamı girin..."
  },
  "nl": {
    "arabicNumber": "Arabisch Getal (1-3999)",
    "romanNumeral": "Romeins Cijfer",
    "enterArabicNumber": "Voer Arabisch getal in...",
    "enterRomanNumeral": "Voer Romeins cijfer in..."
  },
  "sv": {
    "arabicNumber": "Arabiskt Tal (1-3999)",
    "romanNumeral": "Romersk Siffra",
    "enterArabicNumber": "Ange arabiskt tal...",
    "enterRomanNumeral": "Ange romersk siffra..."
  },
  "pl": {
    "arabicNumber": "Liczba Arabska (1-3999)",
    "romanNumeral": "Cyfra Rzymska",
    "enterArabicNumber": "Wprowadź liczbę arabską...",
    "enterRomanNumeral": "Wprowadź cyfrę rzymską..."
  },
  "vi": {
    "arabicNumber": "Số Ả Rập (1-3999)",
    "romanNumeral": "Số La Mã",
    "enterArabicNumber": "Nhập số Ả Rập...",
    "enterRomanNumeral": "Nhập số La Mã..."
  },
  "th": {
    "arabicNumber": "ตัวเลขอารบิก (1-3999)",
    "romanNumeral": "ตัวเลขโรมัน",
    "enterArabicNumber": "ใส่ตัวเลขอารบิก...",
    "enterRomanNumeral": "ใส่ตัวเลขโรมัน..."
  },
  "id": {
    "arabicNumber": "Angka Arab (1-3999)",
    "romanNumeral": "Angka Romawi",
    "enterArabicNumber": "Masukkan angka Arab...",
    "enterRomanNumeral": "Masukkan angka Romawi..."
  },
  "he": {
    "arabicNumber": "מספר ערבי (1-3999)",
    "romanNumeral": "ספרה רומית",
    "enterArabicNumber": "הכנס מספר ערבי...",
    "enterRomanNumeral": "הכנס ספרה רומית..."
  },
  "ms": {
    "arabicNumber": "Nombor Arab (1-3999)",
    "romanNumeral": "Nombor Rom",
    "enterArabicNumber": "Masukkan nombor Arab...",
    "enterRomanNumeral": "Masukkan nombor Rom..."
  },
  "no": {
    "arabicNumber": "Arabisk Tall (1-3999)",
    "romanNumeral": "Romersk Tall",
    "enterArabicNumber": "Skriv inn arabisk tall...",
    "enterRomanNumeral": "Skriv inn romersk tall..."
  }
}
</i18n>

<template>
  <div class="roman-numeral-converter">
    <!-- Arabic Number Input Section -->
    <ToolSectionHeader>{{ $t('arabicNumber') }}</ToolSectionHeader>
    <ToolSection>
      <n-input
        v-model:value="arabicInput"
        :placeholder="$t('enterArabicNumber')"
        :status="arabicInputStatus"
        size="large"
      />
    </ToolSection>
    <ToolSection>
      <CopyToClipboardButton :content="arabicInput" />
    </ToolSection>

    <!-- Roman Numeral Input Section -->
    <ToolSectionHeader>{{ $t('romanNumeral') }}</ToolSectionHeader>
    <ToolSection>
      <n-input
        v-model:value="romanInput"
        :placeholder="$t('enterRomanNumeral')"
        :status="romanInputStatus"
        size="large"
      />
    </ToolSection>
    <ToolSection>
      <CopyToClipboardButton :content="romanInput" />
    </ToolSection>

    <!-- Educational Content -->
    <WhatIsRomanNumeral />
  </div>
</template>

<script setup lang="ts">
import { ref, watch } from 'vue'
import { NInput } from 'naive-ui'
import { ToolSectionHeader, ToolSection } from '@shared/ui/tool'
import { CopyToClipboardButton } from '@shared/ui/base'
import WhatIsRomanNumeral from './WhatIsRomanNumeral.vue'
import { arabicToRoman, romanToArabic, isValidArabicNumber, isValidRomanNumeral } from '../utils/conversion'

// State
const arabicInput = ref('')
const romanInput = ref('')
const arabicInputStatus = ref<'success' | 'warning' | 'error' | undefined>()
const romanInputStatus = ref<'success' | 'warning' | 'error' | undefined>()

// Flag to prevent infinite loop during programmatic updates
let isUpdating = false

// Watch Arabic input and convert to Roman
watch(arabicInput, (newValue) => {
  if (isUpdating) return
  
  if (!newValue) {
    isUpdating = true
    romanInput.value = ''
    arabicInputStatus.value = undefined
    isUpdating = false
    return
  }
  
  const num = parseInt(newValue)
  
  if (isValidArabicNumber(num)) {
    try {
      isUpdating = true
      romanInput.value = arabicToRoman(num)
      arabicInputStatus.value = 'success'
      isUpdating = false
    } catch {
      isUpdating = true
      romanInput.value = ''
      arabicInputStatus.value = 'error'
      isUpdating = false
    }
  } else {
    isUpdating = true
    romanInput.value = ''
    arabicInputStatus.value = 'error'
    isUpdating = false
  }
})

// Watch Roman input and convert to Arabic
watch(romanInput, (newValue) => {
  if (isUpdating) return
  
  if (!newValue) {
    isUpdating = true
    arabicInput.value = ''
    romanInputStatus.value = undefined
    isUpdating = false
    return
  }

  if (isValidRomanNumeral(newValue)) {
    try {
      const result = romanToArabic(newValue)
      isUpdating = true
      arabicInput.value = result.toString()
      romanInputStatus.value = 'success'
      isUpdating = false
    } catch {
      isUpdating = true
      arabicInput.value = ''
      romanInputStatus.value = 'error'
      isUpdating = false
    }
  } else {
    isUpdating = true
    arabicInput.value = ''
    romanInputStatus.value = 'error'
    isUpdating = false
  }
})
</script>

<style scoped>
.roman-numeral-converter {
  max-width: 600px;
  margin: 0 auto;
}
</style>